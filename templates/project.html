{% extends "layout.html" %}

{% block content %}
<section class="project-details">
    <div class="project-header">
        <div class="breadcrumbs">
            <a href="{{ url_for('index') }}">プロジェクト一覧</a> &gt; 
            <span>{{ project.name }}</span>
        </div>
        
        <div class="project-actions">
            <button id="edit-project-btn" class="btn">編集</button>
            <button id="delete-project-btn" class="btn delete">削除</button>
        </div>
    </div>
    
    <div id="edit-project-form" class="form-container" style="display: none;">
        <form action="{{ url_for('update_project', project_id=project.id) }}" method="post">
            <input type="text" name="project_name" value="{{ project.name }}" required>
            <button type="submit" class="btn">更新</button>
            <button type="button" class="btn cancel" onclick="toggleEditProjectForm()">キャンセル</button>
        </form>
    </div>
    
    <div id="delete-project-form" class="form-container" style="display: none;">
        <form action="{{ url_for('delete_project', project_id=project.id) }}" method="post">
            <p>プロジェクト「{{ project.name }}」を削除しますか？</p>
            <button type="submit" class="btn delete">削除</button>
            <button type="button" class="btn cancel" onclick="toggleDeleteProjectForm()">キャンセル</button>
        </form>
    </div>
    
    <div class="project-points">
        <!-- 問題定義 -->
        <div class="point-card" data-point-type="definition">
            <h3>{{ project.points.definition.title }}</h3>
            <ul class="item-list">
                {% for item in project.points.definition.items %}
                <li data-index="{{ loop.index0 }}">
                    <div class="item-content">{{ item }}</div>
                    <div class="item-actions">
                        <button class="edit-item-btn">編集</button>
                        <button class="delete-item-btn">削除</button>
                    </div>
                </li>
                {% endfor %}
                
                {% if not project.points.definition.items %}
                <li class="empty-list">問題定義はまだありません。</li>
                {% endif %}
            </ul>
            
            <form class="add-item-form" action="{{ url_for('add_item', project_id=project.id) }}" method="post">
                <input type="hidden" name="point_type" value="definition">
                <input type="text" name="item_text" placeholder="問題定義を入力" required>
                <button type="submit" class="btn">追加</button>
            </form>
        </div>
        
        <!-- MVP -->
        <div class="point-card" data-point-type="mvp">
            <h3>{{ project.points.mvp.title }}</h3>
            <ul class="item-list">
                {% for item in project.points.mvp.items %}
                <li data-index="{{ loop.index0 }}">
                    <div class="item-content">{{ item }}</div>
                    <div class="item-actions">
                        <button class="edit-item-btn">編集</button>
                        <button class="delete-item-btn">削除</button>
                    </div>
                </li>
                {% endfor %}
                
                {% if not project.points.mvp.items %}
                <li class="empty-list">MVPはまだありません。</li>
                {% endif %}
            </ul>
            
            <form class="add-item-form" action="{{ url_for('add_item', project_id=project.id) }}" method="post">
                <input type="hidden" name="point_type" value="mvp">
                <input type="text" name="item_text" placeholder="MVPを入力" required>
                <button type="submit" class="btn">追加</button>
            </form>
        </div>
        
        <!-- 追加機能 -->
        <div class="point-card" data-point-type="backlog">
            <h3>{{ project.points.backlog.title }}</h3>
            <ul class="item-list">
                {% for item in project.points.backlog.items %}
                <li data-index="{{ loop.index0 }}">
                    <div class="item-content">{{ item }}</div>
                    <div class="item-actions">
                        <button class="edit-item-btn">編集</button>
                        <button class="delete-item-btn">削除</button>
                    </div>
                </li>
                {% endfor %}
                
                {% if not project.points.backlog.items %}
                <li class="empty-list">追加機能はまだありません。</li>
                {% endif %}
            </ul>
            
            <form class="add-item-form" action="{{ url_for('add_item', project_id=project.id) }}" method="post">
                <input type="hidden" name="point_type" value="backlog">
                <input type="text" name="item_text" placeholder="追加機能を入力" required>
                <button type="submit" class="btn">追加</button>
            </form>
        </div>
    </div>
</section>
{% endblock %}
